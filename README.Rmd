---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(areal)
library(dplyr)
library(sf)

data(aw_stl_asthma, package = "areal")
asthma <- aw_stl_asthma

data(aw_stl_race, package = "areal")
race <- aw_stl_race

data(aw_stl_wards, package = "areal")
wards <- aw_stl_wards
```

# areal <img src="man/figures/arealLogo.png" align="right" />

[![lifecycle](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![Travis-CI Build Status](https://travis-ci.org/slu-openGIS/areal.svg?branch=master)](https://travis-ci.org/slu-openGIS/areal)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/slu-openGIS/areal?branch=master&svg=true)](https://ci.appveyor.com/project/chris-prener/areal)
[![Coverage status](https://codecov.io/gh/slu-openGIS/areal/branch/master/graph/badge.svg)](https://codecov.io/github/slu-openGIS/areal?branch=master)
[![CRAN_status_badge](http://www.r-pkg.org/badges/version/areal)](https://cran.r-project.org/package=areal)

`areal` offers an intuitive assortment of options to validate, interpolate, and compare fields between a source and target data set. While methods for implementing areal weighted interpolation are available outside of the `R` ecosystem (ex - toolboxes in ArcGIS) and within `R` (the `sf` package's `st_interpolate_aw`) function, `areal` fills a niche by providing additional functionality not available in `sf` while taking advantage of the reproducibility of `R`. 

`areal` currently implents only areal weighted interpolation, but a roadmap is being developed to add additional interpolation methods as well. This will be posted on the package's website before the initial CRAN release.

## Installation
### Installing Dependencies

You should check the [`sf` package website](https://r-spatial.github.io/sf/) for the latest details on installing dependencies for that package. Instructions vary significantly by operating system. For best results, have `sf` installed before you install `qualmap`. Other dependencies, like `dplyr`, will be installed automatically with `areal` if they are not already present.

### Installing areal
The development version of `areal` can be accessed from Github with `remotes`:

```r
# install.packages("remotes")
remotes::install_github("slu-openGIS/areal")
```

## Usage 
The package contains three overlapping data sets: 

* `aw_stl_race` (2017 ACS demographic counts at the census tract level; *n* = 106) 
* `aw_stl_asthma` (2017 asthma rates at the census tract level; *n* = 106)
* `aw_stl_wards` (the 2010 political subdivisions in St. Louis; *n* = 28). 

These can be used to illustrate the core functionality of the package. 

The basic usage of `areal` is through the `aw_interpolate()` function, which is illustrated below. The following examples assume:

```r
> library(areal)
>
> race <- aw_stl_race
> asthma <- aw_stl_asthma
> wards <- aw_stl_wards
```

### Data Validation
`areal` contains a detailed data validation workflow that ensures that both the `source` and `target` data are compatible with each either. It can be run in a simple format:

```{r validate-simple}
aw_validate(source = asthma, target = wards, varList = c("ASTHMA"))
```

If `aw_validate()` returns a `FALSE` value, it can also be run in a verbose manner that returns a detailed tibble:

```{r validate-verbose}
aw_validate(source = asthma, target = wards, varList = c("ASTHMA"), verbose = TRUE)
```

### Built-in Iteration

One advantage of `areal` is that it allows for multiple values to be interpolated at a time. Here, both total estiatmed population (`TOTAL_E`), the estimated count of white residents (`WHITE_E`), and the estimated count of African American residents (`BLACK_E`) are interpolated at once:

```{r iteration}
aw_interpolate(wards, tid = WARD, source = race, sid = "GEOID", weight = "sum", 
               output = "tibble", extensive = c("TOTAL_E", "WHITE_E", "BLACK_E"))
```

### Interpolation Choices
Both spatially extensive (i.e. counts; illustrated in the prior examples) and spatially intensive (i.e. ratios) data can be interpolated. For spatially intensive data, the average is returned rather than the sum:

```{r intensive}
aw_interpolate(wards, tid = WARD, source = asthma, sid = "GEOID", 
               weight = "sum", output = "tibble", intensive = "ASTHMA")
```

Both extensive and intensive data can be interpolated simultaneously by setting `type` to `"mixed"` and naming two vectors `extensive` and `intensive`. These vectors should include the relevent variable names:

```{r mixed}
# remove sf geometry
raceTable <- race
st_geometry(raceTable) <- NULL

# create combined data
raceTable %>%
  select(GEOID, TOTAL_E, WHITE_E, BLACK_E) %>%
  left_join(asthma, ., by = "GEOID") -> combinedData

# interpolate
aw_interpolate(wards, tid = WARD, source = combinedData, sid = "GEOID",
               weight = "sum", output = "tibble", 
               extensive = c("TOTAL_E", "WHITE_E", "BLACK_E"),
               intensive = c("ASTHMA"))
```

### Output Choices
Output can be either a tibble (shown in the prior example) or an `sf` object:

```{r sf-output}
aw_interpolate(wards, tid = "WARD", source = race, sid = "GEOID",  
               weight = "sum", output = "sf", extensive = "TOTAL_E")
```

### Pipe Compatible

One key advantage of `areal` is that is pipeable, meaning that it can fit easily into existing `tidyverse` workflows:

```{r pipe}
wards %>%
  select(-OBJECTID, -AREA) %>%
  aw_interpolate(tid = WARD, source = race, sid = "GEOID", 
               weight = "sum", output = "tibble", 
               extensive = c("TOTAL_E", "WHITE_E", "BLACK_E"))
```

### Transparent

Another advantage of `areal` is that the interpolation process is not a "black box", but rather can be manually completed if necessary. Details on this will be available on the package's website.
